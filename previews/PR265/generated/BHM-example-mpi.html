<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Rimu with MPI · Rimu.jl</title><meta name="title" content="Rimu with MPI · Rimu.jl"/><meta property="og:title" content="Rimu with MPI · Rimu.jl"/><meta property="twitter:title" content="Rimu with MPI · Rimu.jl"/><meta name="description" content="Documentation for Rimu.jl."/><meta property="og:description" content="Documentation for Rimu.jl."/><meta property="twitter:description" content="Documentation for Rimu.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../index.html"><img src="../assets/logo.png" alt="Rimu.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">Rimu.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Guide</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="BHM-example.html">1D Bose-Hubbard Model</a></li><li class="is-active"><a class="tocitem" href="BHM-example-mpi.html">Rimu with MPI</a></li><li><a class="tocitem" href="G2-example.html">Calculating observables</a></li><li><a class="tocitem" href="exact-example.html">Exact diagonalization</a></li><li><a class="tocitem" href="HO-example.html">Degenerate perturbation theory in a harmonic oscillator basis</a></li></ul></li><li><span class="tocitem">User documentation</span><ul><li><a class="tocitem" href="../exactdiagonalization.html">Exact Diagonalization</a></li><li><a class="tocitem" href="../projectormontecarlo.html">Projector Monte Carlo</a></li><li><a class="tocitem" href="../statstools.html">StatsTools</a></li><li><a class="tocitem" href="../mpi.html">Using MPI</a></li></ul></li><li><span class="tocitem">Developer documentation</span><ul><li><a class="tocitem" href="../interfaces.html">Interfaces</a></li><li><a class="tocitem" href="../hamiltonians.html">Hamiltonians</a></li><li><a class="tocitem" href="../dictvectors.html">Dict vectors</a></li><li><a class="tocitem" href="../addresses.html">BitString addresses</a></li><li><a class="tocitem" href="../stochasticstyles.html">Stochastic styles</a></li><li><a class="tocitem" href="../RMPI.html">RMPI</a></li><li><a class="tocitem" href="../rimuio.html">I/O</a></li><li><a class="tocitem" href="../randomnumbers.html">Random numbers</a></li><li><a class="tocitem" href="../documentation.html">Documentation generation</a></li><li><a class="tocitem" href="../testing.html">Code testing</a></li></ul></li><li><a class="tocitem" href="../API.html">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="BHM-example-mpi.html">Rimu with MPI</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="BHM-example-mpi.html">Rimu with MPI</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/joachimbrand/Rimu.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/joachimbrand/Rimu.jl/blob/develop/scripts/BHM-example-mpi.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Example-2:-Rimu-with-MPI"><a class="docs-heading-anchor" href="#Example-2:-Rimu-with-MPI">Example 2: Rimu with MPI</a><a id="Example-2:-Rimu-with-MPI-1"></a><a class="docs-heading-anchor-permalink" href="#Example-2:-Rimu-with-MPI" title="Permalink"></a></h1><p>In this example, we will demonstrate using Rimu with <a href="https://en.wikipedia.org/wiki/Message_Passing_Interface">MPI</a>. MPI is a standard for parallel and distributed computing, and it is widely used in high-performance computing. Rimu provides support for MPI to enable parallel computations on multiple nodes.</p><p>A runnable script for this example is located <a href="https://github.com/joachimbrand/Rimu.jl/blob/develop/scripts/BHM-example-mpi.jl">here</a>. Run it with 2 MPI ranks with <code>mpirun -n 2 julia BHM-example-mpi.jl</code>.</p><p>We start by importing <code>Rimu</code> and <code>Rimu.RMPI</code>, which contains MPI-related functionality.</p><pre><code class="language-julia hljs">using Rimu
using Rimu.RMPI</code></pre><p>Note that it is not necessary to initialise the MPI library, as this is already done automatically when Rimu is loaded.</p><p>We will compute the ground state of a Bose-Hubbard model in momentum space with 10 particles in 10 sites.</p><p>First, we define the Hamiltonian. We want to start from an address with zero momentum, which is located at mode 5 in the momentum grid. We put all 10 particles, all in the zero momentum mode.</p><pre><code class="language-julia hljs">address = BoseFS(10, 5 =&gt; 10)</code></pre><pre><code class="nohighlight hljs">BoseFS{10,10}(0, 0, 0, 0, 10, 0, 0, 0, 0, 0)</code></pre><p>We will set the interaction strength <code>u</code> to <code>6.0</code>. The hopping strength <code>t</code> defaults to <code>1.0</code>.</p><pre><code class="language-julia hljs">H = HubbardMom1D(address; u=6.0)</code></pre><pre><code class="nohighlight hljs">HubbardMom1D(fs&quot;|0 0 0 0 10 0 0 0 0 0⟩&quot;; u=6.0, t=1.0)</code></pre><p>We set a reporting strategy. We will use <a href="../API.html#Rimu.ReportToFile"><code>ReportToFile</code></a>, which writes the reports directly to a file. This is useful for MPI calculations, as they will typically run non-interactively. The reports will be written to disk and can be inspected later. This has the additional benefit of reducing memory use in long-running jobs, as we don&#39;t need to keep the results in memory. It also allows us to inspect the results before the computation finishes and recover some data if it fails.</p><p>The default settings will ensure that only the root MPI rank will write to the file, which is reasonable, and that data is saved in chunks of 1000 time steps. We choose to suppress progress messages with setting <code>io=devnull</code>.</p><pre><code class="language-julia hljs">reporting_strategy = ReportToFile(
    filename=&quot;result.arrow&quot;,
    io=devnull
)</code></pre><pre><code class="nohighlight hljs">ReportToFile{Symbol}(&quot;result.arrow&quot;, 1, 1000, true, false, Base.DevNull(), :zstd, nothing)</code></pre><p>For running parallel computations with MPI, it is important that a compatible state vector is used. Here we explicitly set up an MPI-enabled state vector, <a href="../dictvectors.html#Rimu.DictVectors.PDVec"><code>PDVec</code></a>, which is automatically MPI-distributed over the available number of MPI ranks. In addition, threading will be used with all threads available to Julia.</p><pre><code class="language-julia hljs">initial_vector = PDVec(address =&gt; 1.0; style=IsDynamicSemistochastic())</code></pre><pre><code class="nohighlight hljs">1-element PDVec: style = IsDynamicSemistochastic{Float64,ThresholdCompression,DynamicSemistochastic}()
  fs&quot;|0 0 0 0 10 0 0 0 0 0⟩&quot; =&gt; 1.0</code></pre><p>Now, we can set other parameters as usual. We will perform the computation with 10000 walkers and for 10000 time steps. We will also compute the projected energy by passing a <a href="../API.html#Rimu.ProjectedEnergy"><code>ProjectedEnergy</code></a> object as a <code>post_step_strategy</code>.</p><pre><code class="language-julia hljs">problem = ProjectorMonteCarloProblem(H;
    start_at=initial_vector,
    reporting_strategy,
    post_step_strategy=ProjectedEnergy(H, initial_vector),
    target_walkers=10_000,
    time_step=1e-4,
    last_step=10_000
);</code></pre><p>The <a href="../RMPI.html#Rimu.RMPI.@mpi_root-Tuple"><code>@mpi_root</code></a> macro performs an action on the root rank only, which is useful for printing.</p><pre><code class="language-julia hljs">@mpi_root println(&quot;Running FCIQMC with &quot;, mpi_size(), &quot; rank(s).&quot;)</code></pre><pre><code class="nohighlight hljs">Running FCIQMC with 1 rank(s).
</code></pre><p>Finally, we can run the computation.</p><pre><code class="language-julia hljs">simulation = solve(problem);

@mpi_root println(&quot;Simulation success = &quot;, simulation.success)</code></pre><pre><code class="nohighlight hljs">Simulation success = true
</code></pre><p>Once the calculation is done, the results are available in the arrow file on disk.</p><p>In a typical workflow, the simulation results would be loaded from disk and analysed in the REPL or with a separate script. The arrow file can be loaded into a <code>DataFrame</code> with metadata using the <a href="../rimuio.html#Rimu.RimuIO.load_df-Tuple{Any}"><code>load_df</code></a> function.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="BHM-example.html">« 1D Bose-Hubbard Model</a><a class="docs-footer-nextpage" href="G2-example.html">Calculating observables »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Friday 26 July 2024 01:41">Friday 26 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
